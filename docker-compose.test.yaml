# This override file should be used when running automated tests so
# that test output is saved to the host

services:
  aphw-ddi-enforcement:
    build:
      target: development
    image: aphw-ddi-enforcement-development
    container_name: aphw-ddi-enforcement-test
    command: npm run test
    volumes:
      - ./test:/home/node/test
      - ./test-output:/home/node/test-output
      - ./jest.config.js:/home/node/jest.config.js
      - ./package.json:/home/node/package.json
    depends_on: 
      - aphw-ddi-enforcement-azurite
    environment:
      AZURE_STORAGE_CONNECTION_STRING: "DefaultEndpointsProtocol=http;AccountName=devstoreaccount1;AccountKey=Eby8vdM02xNOcqFlqUwJPLlmEtlCDXJ1OUzFT50uSRZ6IFsuFq2UVErCz4I6tq/K1SZFPTOtr/KBHBeksoGMGw==;BlobEndpoint=http://aphw-ddi-enforcement-azurite:10000/devstoreaccount1;TableEndpoint=http://aphw-d-azurite:10002/devstoreaccount1;"
      DDI_API_BASE_URL: test
      DDI_EVENTS_BASE_URL: test-events
      NODE_OPTIONS: "--max-old-space-size=3072"
      # This is a fake private key used purely for testing
      JWT_PRIVATE_KEY: "LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2QUlCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktZd2dnU2lBZ0VBQW9JQkFRQ3BwS2Q3TUVQOXBzL3UKQ0hRN1o0YWxlRUxmdXhiZ3BqRFRoSVVkTjBTYlJCeUFoUytaVXlMaStLeDR0cXI2aDVXRmFEN2l0d0IwM2ZMaQpWUHI5S1E1RUhYZVNOSnI3MnBqbndaV2xPWDNSVTNrQnNBbnl6bDlodGQ1Qkx2RkRucXIramRzMTF1VlVHMjdGCjlsRWJ6cHRlRUNEYW1oZXR5ZUhTN2o1MGo5Z1lrSjhvQkk2WDlqdXI0MWJrUEM4YUg0NnVMSis2TjJYYkJLcXIKMzZLWGdLSFppMzR0RzNEcStzQTNKUkVtRDcySFJEUDAxNUs2R3RERFNuSGNwdWFkUDVGeTUzZW1IUjFjMzg1awpZSCtIaUErV25PZnhwcUFxaGxUSnQ3ZWxqdTRpRVJEaTBKZEtmWGxWNDBiUVdPWVdjdXdlVGYyUmYzWnQ2ZUsvCmZ0OXYxcWovQWdNQkFBRUNnZ0VBWTN0TE85SnlESzFtQWhDekdLTDlNc3Z6YTRBclNsSXJEOThHc0x0WVlEVHgKQWUwWW5MRkVKQlh3RGxvUXFob1lkTU5OSFdaenZoVHAraEFibjVvVDQ1M2tJTGo0cWZqbThnRno0QkIyMStvNwphK0h2ODVOU0c5cXJHMDZMN1R0K3l3Z2xKTTJBYm5JbjQ2OHVvVC9ubktHWW9wajZpYzk1dmxnNEIrTFN0cFFqCjJqcnZYbWh5ZTkrSXgzcGhWS0FET2FMZStnU3FtNzVRelg4MjZQZXNwSCtTS1g3N1h5K2Qva2p3SEk2V1R6NHUKQnFiUlF0dDZzVGZ6TytxNHgrOWN1NlBSOWljcnpLcERRVkNtZTF1ZlpIVEp1aUxvZEJDcnp1STdsdks3eG5pZQpzdzR4cWg0ZGFHd0J0VXFZS0lZQ2VwVDY0TlpYMG43L1I2RXVDTW9jQVFLQmdRRGQ4dFB4OGNqVDk1b2UzN3M1CldWTHhpbUlYRWhmRko3SEZ4OC9aMHUrVlQ1dTFwZVlOK1dDQUhMRENXR0I0QnlOM1R5M3oySnkwM0Q0UnZETnEKcERaUkxNRmJHUHFZNC9pb1k5aVRRU3BRT1VLSlVFaUVsTEI2OUZlU3pVSVNLNlZvMzUrSW1FK1lJc2wwOTVLUgpwUzY5KzNNenNPUitIMzRVaWNGRnpHTUpEd0tCZ1FERHEzL1hoa0l1akx0d2RRZG5EVkF2YUN4cjVzUmR4RkVhCjlDZWcybXlySnZONEc2bnpReXNBZllhTEZ3VFZtN09lajFzRklaRlBNRC90OU1TUENGUkFNMk15VlZWeTNJTkoKR0h3bHZ6WWlzZGRseHpta0VLaXBxY3hiZFV6eW1qT1AyUjB6MWhqd3QyaG9IT2NROVRqUFJ5WGp2SzR6N2xsYgpEOHU4dmlZQkVRS0JnQldqOVpKamxzZEVIeHpmaDZ2Qno5cUpPYU15T21zWXdiYWRFdUVVTmhRQzNSWExCVEZiCm5WTWdlUU9hQmwzdHBFR2YwTVV6MjZPdXpjYUE2U3ArdEdVWnpnaUoyUFZMVlJWbUZ0blV3c0ZyczljYm90WjYKZ1BLY0hHWE42YUZIN0NyYmt2eUlqVW95S2g1amZVRUNNQnFLQitPRVhlTUdRdzdSbDZ5c2p3TjFBb0dBWGl4TwpiVGFLNThpSDlnbjlOQlh1UDhMTmpta1VuV1I4L0pJQitLTG5wa0FxOGVXdW1Bdjl5RkNoenBPWG1nOUVGYzQ5CkttMExlS2RxUFdhT3E2Q0FuQjJmWW53N2tmcWJuVFNSbThFNWx0MHRKQ2tNanZBTm5RckI5a3F3YkJyWE1pWjIKclpvZmlzdGJEckRLYlJqNDdKbjduRzRWRVoxbm1ESTBCblVsNldFQ2dZQm5RbmNZSDJDUGg1R2xxOHdzTFQ3TwpoeHoxWU1GNGdUOWltUmR6TEN6RGFzTGxMaXhXMnZWVEhEdVdvMW1HSnZ3NjJkaTI1YUFDRFJZN1cxcmRHN1BNCnRnTnlYK0puRkhKTmp3NGd4dDJtQkJLT1U3OVo0WHU4L1BFdUtURUpjVWh5WnNkS2lIa3hvNW5Eakt0WEJkRDkKOXgzUmRkNXFPMGFNL2lxNFVqNFpCZz09Ci0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0="
      OPENID_PRIVATE_KEY: "MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQDgapHzAWFAeHzgSHNwF5UwhTZ300pDWj0y7thFnWBZwad2PXIalxNYks3ZkiZF0ZfdX8ghlO0pM1Bn8VIbUeP2FG+T80qE7QBXGNo1JMBHf+OWuUVBs5riRwj8r2v2TBObQYxQoLPDgLYI9p09hCv+kUwRXa5+InzGoheBDu4Hl0S9uJyVH6tbCILDrlvQ74gx6ZLayuxc4XwsPzyoyR3inVsXYH1yvze87eHd2fwuzFQoz1Y9tup+G2AWoW2p/dkWSL1dCT34dbF7vlbi/SOb43I3IQ6NCrpp25YJS+2CjYFQaSBZ/IeDlx8f9K9bOw+tR8XmgiZvc+HM/1FXNo6xAgMBAAECggEAAMWbEWQvp3CI8OyWA9kWxlwMOd6EjCIZTLNKT07GXhfPWRFG14JpSY+txyKLVUgXhA01dU94GlN9EEktSdPACkHCryrjLWrsYUKZRni3ao74kAL8pTO8FQylxKHN3td6ha27gz2pjOnbidxxghpml7sug1yr1ZNkz1D9EtU4Tfca8rhsLzBbBeGeLu+E8b6j71RN2M5300KHFA1FCnxwY20dNQlkaPxZSrHrE76mdY/oc7BU8pZU4KM2tzfh98hq/6mA+wkh2+u/bGrv732ZFakS7hNxrmZhHytyv4zqBBTqVQgn/oFdL0RQD0fI+NkxR/Idn9+tZa7+ece1jRRBoQKBgQD9l0zX2tLI6YWZLb2U5XTwbzjLw/M1j9JHNvgpaStOCi/YybfD4LvqMTH+REeUYitJMHM7S8favfHhpdGbJ8VLWWPzZ1RD1cQnFaMIkYYCHhWC4U52xoBh2z83JF4w2xx6WVVF6RU52RzuKg9NCMB3lMbncE1R4Jzh+8tV5L/QoQKBgQDijFIkTP0EFPpGo40eBndWOIHqBFhE57th2RwEfQ5atg+lMhPSPLd/LmQ+6p/5YP5akb8/5Szc/DfQ1TnqrS5eLBq5BaFNv7qw6iSt98qTxIrRcfjKoayVcQ4M0vWCfy7uq1N2E36OZusu/8lLQS+lSvb/ywxWqF+s7/MwFHk0EQKBgQDXrqOQw3CbqOIUEi84QKBhDnfD9vkYCSbToxEWR3ipe0iOnaJKWw34dbcLh49JyOT/7tFTEXT9uqfLP3ky+XR4TaMRFkU5HMskYuazFvJfQq8RDgfqRZJTqGHvyGLEMtfZx7kbKM8A0IQmnGc/Ib5w9nzlw0I/7UYBfmLGvzPVgQKBgC3hz20Mrp2aBgoya40uMBMlRKJ5mMrzx86MYxFBppuWjdqeJseIhn1ajvDzIc0m6Ly9EefF6W0kI8XGuYEe6+okspDQZBfUAeJ8uUsGiV+eCaNbmtCnJ8XobLkKLLDuQzoRNskOL651h6IwKbt1C0pFwXqSy//s/9uNiUoui1GRAoGBAPTK7RRf4vup06yXt9W6D3lB0zA5pICMs2o64xkRxbjK9QvzRktwDaADRzrVR5GWuqyhefkjt6BpdxHTeKXdDXzO8UffbKYg1grEIBx201m21pZRKwMfU68xseaLqMLdXdQ7E2RQPnoyUXG1D/68i4mgAyTXNt8B1U6wtlSdGnmk"
      OPENID_PUBLIC_KEY: "MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA4GqR8wFhQHh84EhzcBeVMIU2d9NKQ1o9Mu7YRZ1gWcGndj1yGpcTWJLN2ZImRdGX3V/IIZTtKTNQZ/FSG1Hj9hRvk/NKhO0AVxjaNSTAR3/jlrlFQbOa4kcI/K9r9kwTm0GMUKCzw4C2CPadPYQr/pFMEV2ufiJ8xqIXgQ7uB5dEvbiclR+rWwiCw65b0O+IMemS2srsXOF8LD88qMkd4p1bF2B9cr83vO3h3dn8LsxUKM9WPbbqfhtgFqFtqf3ZFki9XQk9+HWxe75W4v0jm+NyNyEOjQq6aduWCUvtgo2BUGkgWfyHg5cfH/SvWzsPrUfF5oImb3PhzP9RVzaOsQIDAQAB"
      OPENID_CLIENT_ID: "abcdefghijk"
      AUTHENTICATION_ENABLED: false

  aphw-ddi-enforcement-azurite:
    image: mcr.microsoft.com/azure-storage/azurite:3.23.0
